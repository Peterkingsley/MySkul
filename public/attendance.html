<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attendance - Local Data</title>
    <!-- Use Tailwind CSS for rapid styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Customizing the Tailwind theme to match the UI's color palette
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'dark-bg': '#191A23',
                        'dark-card': '#252733',
                        'dark-border': '#3D3D4E',
                        'dark-text': '#A8A8B3',
                        'dark-text-bold': '#E5E5E5',
                        'brand-purple': '#5A63F8',
                        'brand-blue': '#407BFF',
                        'brand-teal': '#28B7A5',
                        'brand-orange': '#FF7C40',
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom CSS for body and animations */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #191A23;
            color: #E5E5E5;
        }
        /* Style for the mobile menu button */
        .mobile-menu-button {
            position: fixed;
            top: 1rem;
            left: 1rem;
            z-index: 50;
        }
        /* Custom modal styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            transition: opacity 0.3s ease;
        }
        .modal-content {
            background-color: #252733;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            max-width: 400px;
            width: 90%;
            text-align: center;
            border: 1px solid #3D3D4E;
            transform: scale(0.95);
            transition: transform 0.3s ease;
        }
        .modal:not(.hidden) .modal-content {
            transform: scale(1);
        }
    </style>
</head>
<body class="bg-dark-bg min-h-screen font-sans text-dark-text-bold">

    <!-- Mobile Menu Button -->
    <button id="mobileMenuButton" class="lg:hidden mobile-menu-button p-2 text-dark-text-bold rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-purple">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
    </button>
    
    <!-- Main content container using flexbox for desktop layout -->
    <div class="flex flex-col lg:flex-row min-h-screen">
        <!-- Sidebar -->
        <aside id="sidebar" class="bg-dark-card w-64 p-4 flex flex-col justify-between transition-transform duration-300 ease-in-out transform -translate-x-full lg:translate-x-0 fixed lg:relative lg:flex-shrink-0 inset-y-0 left-0 z-40 border-r border-dark-border">
            <!-- Logo and Navigation -->
            <div>
                <!-- Logo -->
                <div class="mb-4 flex items-center space-x-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-brand-purple" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                        <path d="M2 17l10 5 10-5"></path>
                        <path d="M2 12l10 5 10-5"></path>
                    </svg>
                    <h1 class="text-xl font-bold text-dark-text-bold">EduDash</h1>
                </div>
                
                <!-- Navigation Links -->
                <nav>
                    <ul>
                        <li><a href="dashboard.html" class="flex items-center space-x-3 p-3 rounded-xl font-medium text-dark-text hover:bg-dark-border transition-colors duration-200 mb-2"><span>Dashboard</span></a></li>
                        <li><a href="students.html" class="flex items-center space-x-3 p-3 rounded-xl font-medium text-dark-text hover:bg-dark-border transition-colors duration-200 mb-2"><span>Students</span></a></li>
                        <li><a href="class.html" class="flex items-center space-x-3 p-3 rounded-xl font-medium text-dark-text hover:bg-dark-border transition-colors duration-200 mb-2"><span>Classes</span></a></li>
                        <li><a href="attendance.html" class="flex items-center space-x-3 p-3 rounded-xl font-semibold text-white bg-brand-purple hover:bg-brand-purple/80 transition-colors duration-200 mb-2"><span>Attendance</span></a></li>
                    </ul>
                </nav>
            </div>
            
            <!-- User Profile/Logout -->
            <div class="pt-4 border-t border-dark-border">
                <a href="index.html" class="flex items-center space-x-3 p-3 rounded-xl font-medium text-dark-text hover:bg-dark-border transition-colors duration-200">
                    <span>Logout</span>
                </a>
            </div>
        </aside>

        <!-- Main Content Area: Responsive and scrollable -->
        <main class="flex-1 p-4 overflow-y-auto transition-all duration-300 ease-in-out">
            <h2 class="text-2xl font-bold mb-6">Student Attendance</h2>
            
            <!-- Student Name Input Section -->
            <div id="nameInputSection" class="flex flex-col items-center justify-center p-6 bg-dark-card rounded-xl border border-dark-border mb-8">
                <h3 class="text-lg font-bold mb-4">Enter Student Name for Attendance</h3>
                <form id="attendance-form" class="w-full max-w-sm flex flex-col space-y-4">
                    <input type="text" id="student-name-input" placeholder="Enter student's full name" class="w-full p-3 rounded-lg bg-dark-bg border border-dark-border focus:outline-none focus:ring-2 focus:ring-brand-purple text-dark-text-bold" required>
                    <button type="submit" class="w-full p-3 bg-brand-purple rounded-lg text-white font-semibold hover:bg-brand-purple/80 transition-colors duration-200">
                        Record Attendance
                    </button>
                </form>
                <div id="statusMessage" class="text-dark-text mt-4">Waiting for name entry...</div>
            </div>

            <!-- Student Profile Section (initially hidden) -->
            <div id="studentProfile" class="hidden bg-dark-card rounded-xl border border-dark-border p-6 space-y-6">
                <div class="flex flex-col md:flex-row items-center space-y-4 md:space-y-0 md:space-x-6">
                    <img id="profile-picture" src="https://placehold.co/128x128/3D3D4E/A8A8B3?text=Student" alt="Student Profile Picture" class="w-32 h-32 rounded-full border-2 border-brand-purple">
                    <div class="text-center md:text-left">
                        <h3 class="text-2xl font-bold" id="profile-name"></h3>
                        <p class="text-dark-text" id="profile-class"></p>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="space-y-2">
                        <p class="font-bold text-dark-text-bold">Student ID</p>
                        <p class="text-dark-text" id="profile-id"></p>
                    </div>
                    <div class="space-y-2">
                        <p class="font-bold text-dark-text-bold">Date of Birth</p>
                        <p class="text-dark-text" id="profile-dob"></p>
                    </div>
                    <div class="space-y-2">
                        <p class="font-bold text-dark-text-bold">Parent Name</p>
                        <p class="text-dark-text" id="profile-parent-name"></p>
                    </div>
                    <div class="space-y-2">
                        <p class="font-bold text-dark-text-bold">Parent Number</p>
                        <p class="text-dark-text" id="profile-parent-number"></p>
                    </div>
                    <div class="space-y-2">
                        <p class="font-bold text-dark-text-bold">Fees Paid</p>
                        <p class="text-dark-text text-brand-teal" id="profile-fees-paid"></p>
                    </div>
                    <div class="space-y-2">
                        <p class="font-bold text-dark-text-bold">Fees Outstanding</p>
                        <p class="text-dark-text text-brand-orange" id="profile-fees-outstanding"></p>
                    </div>
                </div>

                <div id="attendance-success-message" class="text-center mt-6">
                    <h4 class="text-xl font-bold text-brand-teal mb-2"></h4>
                    <p class="text-dark-text"></p>
                </div>
            </div>
            
            <!-- Custom Modal for Messages -->
            <div id="messageModal" class="modal hidden">
                <div class="modal-content">
                    <h3 id="modal-title" class="text-xl font-bold mb-4"></h3>
                    <p id="modal-message" class="text-dark-text mb-6"></p>
                    <button id="modal-close-btn" class="p-3 bg-brand-purple rounded-lg text-white font-semibold hover:bg-brand-purple/80 transition-colors duration-200 w-full">
                        OK
                    </button>
                </div>
            </div>
            
        </main>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Local Data Source (JSON Objects) ---
            const studentsData = {
                'S-001': { name: 'Emily White', class: 'Grade 10', dob: '2006-03-15', picture: 'https://placehold.co/128x128/3D3D4E/E5E5E5?text=EW', parent: { name: 'Sarah White', number: '555-1234' }, fees: { paid: 500, outstanding: 100 } },
                'S-002': { name: 'Michael Brown', class: 'Grade 11', dob: '2005-07-20', picture: 'https://placehold.co/128x128/3D3D4E/E5E5E5?text=MB', parent: { name: 'David Brown', number: '555-5678' }, fees: { paid: 600, outstanding: 0 } },
                'S-003': { name: 'Sophia Davis', class: 'Grade 9', dob: '2008-11-01', picture: 'https://placehold.co/128x128/3D3D4E/E5E5E5?text=SD', parent: { name: 'Jessica Davis', number: '555-9012' }, fees: { paid: 450, outstanding: 50 } }
            };
            const attendanceData = {}; // Object to store attendance, e.g., { 'S-001-2025-08-14': true }

            // --- UI Element References ---
            const sidebar = document.getElementById('sidebar');
            const mobileMenuButton = document.getElementById('mobileMenuButton');
            
            const attendanceForm = document.getElementById('attendance-form');
            const studentNameInput = document.getElementById('student-name-input');
            const nameInputSection = document.getElementById('nameInputSection');
            const studentProfile = document.getElementById('studentProfile');
            const statusMessage = document.getElementById('statusMessage');

            // Profile display elements
            const profilePicture = document.getElementById('profile-picture');
            const profileName = document.getElementById('profile-name');
            const profileClass = document.getElementById('profile-class');
            const profileId = document.getElementById('profile-id');
            const profileDob = document.getElementById('profile-dob');
            const profileParentName = document.getElementById('profile-parent-name');
            const profileParentNumber = document.getElementById('profile-parent-number');
            const profileFeesPaid = document.getElementById('profile-fees-paid');
            const profileFeesOutstanding = document.getElementById('profile-fees-outstanding');
            const attendanceSuccessMessage = document.getElementById('attendance-success-message');
            
            // Modal elements
            const messageModal = document.getElementById('messageModal');
            const modalTitle = document.getElementById('modal-title');
            const modalMessage = document.getElementById('modal-message');
            const modalCloseBtn = document.getElementById('modal-close-btn');

            // --- Helper Functions ---

            function showMessage(title, message) {
                modalTitle.textContent = title;
                modalMessage.textContent = message;
                messageModal.classList.remove('hidden');
            }

            modalCloseBtn.addEventListener('click', () => {
                messageModal.classList.add('hidden');
            });

            function updateProfileUI(studentId, studentData) {
                profilePicture.src = studentData.picture;
                profileName.textContent = studentData.name;
                profileClass.textContent = `Class: ${studentData.class}`;
                profileId.textContent = studentId;
                profileDob.textContent = studentData.dob;
                profileParentName.textContent = studentData.parent.name;
                profileParentNumber.textContent = studentData.parent.number;
                profileFeesPaid.textContent = `$${studentData.fees.paid}`;
                profileFeesOutstanding.textContent = `$${studentData.fees.outstanding}`;

                nameInputSection.classList.add('hidden');
                studentProfile.classList.remove('hidden');
            }

            // --- Event Listeners ---

            mobileMenuButton.addEventListener('click', () => {
                sidebar.classList.toggle('-translate-x-full');
            });

            attendanceForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const studentNameQuery = studentNameInput.value.trim().toLowerCase();
                if (!studentNameQuery) {
                    showMessage("Input Required", "Please enter a student's name.");
                    return;
                }

                statusMessage.textContent = "Searching for student...";
                
                // Find student by name
                const foundStudentId = Object.keys(studentsData).find(id => 
                    studentsData[id].name.toLowerCase() === studentNameQuery
                );

                if (foundStudentId) {
                    const studentData = studentsData[foundStudentId];
                    const today = new Date().toISOString().slice(0, 10); // YYYY-MM-DD
                    const attendanceKey = `${foundStudentId}-${today}`;

                    updateProfileUI(foundStudentId, studentData);

                    if (attendanceData[attendanceKey]) {
                        // Attendance already recorded
                        attendanceSuccessMessage.querySelector('h4').textContent = 'Already Marked!';
                        attendanceSuccessMessage.querySelector('p').textContent = `Attendance for ${studentData.name} has already been recorded today.`;
                    } else {
                        // Record attendance
                        attendanceData[attendanceKey] = true;
                        attendanceSuccessMessage.querySelector('h4').textContent = 'Attendance Recorded!';
                        attendanceSuccessMessage.querySelector('p').textContent = `Attendance for today has been successfully marked.`;
                    }
                } else {
                    statusMessage.textContent = "Student not found.";
                    showMessage("Student Not Found", "No student found with that name. Please check the spelling and try again.");
                    nameInputSection.classList.remove('hidden');
                    studentProfile.classList.add('hidden');
                }
                studentNameInput.value = ''; // Clear the input field
            });
        });
    </script>
</body>
</html>
